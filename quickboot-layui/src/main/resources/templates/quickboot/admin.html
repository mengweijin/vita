<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:replace="quickboot/include::head('QuickBoot Admin')"></head>

<body>
    <div class="layui-layout layui-layout-admin">

        <div class="layui-header" th:insert="quickboot/header::header"></div>
        <div class="layui-side layui-bg-black" th:insert="quickboot/side::side"></div>

        <div class="layui-body">
            <div class="layui-tab layui-tab-brief" lay-allowClose="true" style="margin: 0 0; height: 100%;"
                lay-filter="main_tab_filter">
                <ul class="layui-tab-title">
                    <li lay-id="home" class="layui-this">首页</li>
                </ul>
                <ul id="main_tab_right_menu" style="display: none;position: absolute;">
                    <li lay-tab-right-menu-event="closeLeft">关闭左侧</li>
                    <li lay-tab-right-menu-event="closeRight">关闭右侧</li>
                    <li lay-tab-right-menu-event="closeOther">关闭其他</li>
                    <li lay-tab-right-menu-event="closeAll">关闭全部</li>
                </ul>
                <div class="layui-tab-content" style="padding:0 0; padding-left: 15px; height: calc(100% - 44px);">
                    <div class="layui-tab-item layui-show" style="height: 100%;">
                        <iframe src="/quickboot/demo/img" scrolling="auto" frameborder="no" width="100%" height="100%"></iframe>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-footer" style="text-align: center;" th:insert="quickboot/include::footer"></div>
    </div>

    <!--/** thymeleaf 中一定要使用 th:inline="javascript"，否则 [[${变量名}]] 从后端中取得的值是一个字符串，而不是一个 json 对象 **/-->
    <script th:inline="javascript">
        layui.use(['element', 'jquery', 'util'], function () {
            let element = layui.element, $ = layui.$, util = layui.util;

            util.event('lay-tab-right-menu-event', {
                closeLeft: function (othis) {
                    $.tab.closeLeft('main_tab_filter', othis.attr('lay-id'));
                },
                closeRight: function (othis) {
                    $.tab.closeRight('main_tab_filter', othis.attr('lay-id'));
                },
                closeOther: function (othis) {
                    $.tab.closeOther('main_tab_filter', othis.attr('lay-id'));
                },
                closeAll: function (othis) {
                    $.tab.closeAll('main_tab_filter', othis.attr('lay-id'));
                }

            });

            // Tab 切换，以改变地址 hash 值
            element.on('tab(main_tab_filter)', function () {
                location.hash = 'tab=' + this.getAttribute('lay-id');
            });

            window.addEventListener('hashchange', () => {
                // 通过 location.hash 获取到最新的 hash 值
                // 获取hash来切换选项卡，假设当前地址的hash为lay-id对应的值
                let layid = location.hash.replace(/^#tab=/, '');
                //假设当前地址为：http://a.com#tab=2，那么选项卡会自动切换到 lay-id="2" 这一项
                element.tabChange('main_tab_filter', layid);
            });

            window.onload = function windowOnload() {
                let layid = location.hash.replace(/^#tab=/, '');
                //let $opened = $("[lay-filter='main_tab_filter'] ul.layui-tab-title li[lay-id='" + layid + "']");

                element.tabChange('main_tab_filter', layid);
            }



        });

    </script>
</body>

</html>