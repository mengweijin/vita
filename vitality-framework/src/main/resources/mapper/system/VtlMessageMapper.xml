<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.mengweijin.vitality.system.mapper.VtlMessageMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.github.mengweijin.vitality.system.entity.VtlMessage">
        <result column="ID" property="id" />
        <result column="TYPE" property="type" />
        <result column="AVATAR" property="avatar" />
        <result column="TITLE" property="title" />
        <result column="DESCRIPTION" property="description" />
        <result column="RELEASED" property="released" />
        <result column="CONFIRMED" property="confirmed" />
        <result column="HANDLED" property="handled" />
        <result column="URL_LINK" property="urlLink" />
        <result column="CREATE_BY" property="createBy" />
        <result column="CREATE_TIME" property="createTime" />
        <result column="UPDATE_BY" property="updateBy" />
        <result column="UPDATE_TIME" property="updateTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="BaseColumn">
        t.ID,
        t.TYPE,
        t.AVATAR,
        t.TITLE,
        t.DESCRIPTION,
        t.RELEASED,
        t.CONFIRMED,
        t.HANDLED,
        t.URL_LINK,
        t.CREATE_BY,
        t.CREATE_TIME,
        t.UPDATE_BY,
        t.UPDATE_TIME
    </sql>

    <!-- 通用 Where 条件列 -->
    <sql id="BaseWhere">
        <where>
            <if test="p.id != null" >
                and t.ID = #{p.id}
            </if>
            <if test="p.type != null ">
                and t.TYPE = #{p.type}
            </if>
            <if test="p.avatar != null and p.avatar != '' ">
                and t.AVATAR = #{p.avatar}
            </if>
            <if test="p.title != null and p.title != '' ">
                and t.TITLE = #{p.title}
            </if>
            <if test="p.description != null and p.description != '' ">
                and t.DESCRIPTION = #{p.description}
            </if>
            <if test="p.released != null" >
                and t.RELEASED = #{p.released}
            </if>
            <if test="p.confirmed != null" >
                and t.CONFIRMED = #{p.confirmed}
            </if>
            <if test="p.handled != null" >
                and t.HANDLED = #{p.handled}
            </if>
            <if test="p.urlLink != null and p.urlLink != '' ">
                and t.URL_LINK = #{p.urlLink}
            </if>
            <if test="p.createBy != null" >
                and t.CREATE_BY = #{p.createBy}
            </if>
            <if test="p.createTime != null" >
                and t.CREATE_TIME = #{p.createTime}
            </if>
            <if test="p.updateBy != null" >
                and t.UPDATE_BY = #{p.updateBy}
            </if>
            <if test="p.updateTime != null" >
                and t.UPDATE_TIME = #{p.updateTime}
            </if>
        </where>
    </sql>

    <!-- 通用 Where Like 条件列 -->
    <sql id="BaseWhereLike">
        <where>
            <if test="p.id != null" >
                and t.ID = #{p.id}
            </if>
            <if test="p.type != null ">
                and t.TYPE = #{p.type}
            </if>
            <if test="p.avatar != null and p.avatar != '' ">
                and t.AVATAR like concat(concat('%', #{p.avatar}), '%')
            </if>
            <if test="p.title != null and p.title != '' ">
                and t.TITLE like concat(concat('%', #{p.title}), '%')
            </if>
            <if test="p.description != null and p.description != '' ">
                and t.DESCRIPTION like concat(concat('%', #{p.description}), '%')
            </if>
            <if test="p.released != null" >
                and t.RELEASED = #{p.released}
            </if>
            <if test="p.confirmed != null" >
                and t.CONFIRMED = #{p.confirmed}
            </if>
            <if test="p.handled != null" >
                and t.HANDLED = #{p.handled}
            </if>
            <if test="p.urlLink != null and p.urlLink != '' ">
                and t.URL_LINK like concat(concat('%', #{p.urlLink}), '%')
            </if>
            <if test="p.createBy != null" >
                and t.CREATE_BY = #{p.createBy}
            </if>
            <if test="p.createTime != null" >
                and t.CREATE_TIME = #{p.createTime}
            </if>
            <if test="p.updateBy != null" >
                and t.UPDATE_BY = #{p.updateBy}
            </if>
            <if test="p.updateTime != null" >
                and t.UPDATE_TIME = #{p.updateTime}
            </if>
        </where>
    </sql>

    <select id="page" resultType="com.github.mengweijin.vitality.system.dto.VtlMessageDTO">
        select
        <include refid="BaseColumn"/>,
        cu.NICKNAME as create_by_name,
        uu.NICKNAME as update_by_name
        from VTL_MESSAGE t
        left join VTL_USER cu on cu.ID = t.CREATE_BY
        left join VTL_USER uu on uu.ID = t.UPDATE_BY
        <include refid="BaseWhereLike"/>
        order by t.CREATE_TIME desc
    </select>

</mapper>
