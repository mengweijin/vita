System.register([],(function(e,t){"use strict";return{execute:function(){let t=layui.$,n=e("u",{isMobile:function(){return t(window).width()<=750},isString:function(e){return"string"==typeof e||e instanceof String},isBlank:function(e){if(!e){let t=e.toString().replace(/\s/g,"").trim();return""==t||"undefined"==t||"null"==t}return!0},isEmpty:function(e){return!e||(this.isString(e)?this.isBlank(e):0===Object.getOwnPropertyNames(e).length)},isValidCssSelector:function(e){try{return document.querySelector(e),!0}catch(t){return!1}},blankToDefault:function(e,t){return this.isBlank(e)?t:e},removePrefix:function(e,t){return e.startsWith(t)?e.slice(t.length):e},removeSuffix:function(e,t){return e.endsWith(t)?e.slice(0,-t.length):e},getCssVar:function(e){let t=document.documentElement;return getComputedStyle(t).getPropertyValue(e)}});const o="vita-storage";let i=e("d",{name:"user",get:function(){return layui.sessionData(o)[this.name]},set:function(e){layui.sessionData(o,{key:this.name,value:e})},del:function(){layui.sessionData(o,{key:this.name,remove:!0})},getToken:function(){return this.get()?.token}}),a=layui.$,s=layui.layer,r={get:function(e){return e.method="GET",e.processData=!0,this.request(e)},post:function(e){return e.method="POST",e.processData=!1,this.request(e)},request:function(e){return new Promise((function(t,o){a.ajax({loading:e.loading??!0,layerIndex:e.layerIndex??-1,method:e.method??"POST",url:e.url,data:e.data,async:e.async??!0,cache:e.cache??!0,contentType:e.contentType??"application/json;charset=UTF-8",processData:e.processData??!1,dataType:e.dataType??"json",headers:e.header??{Authorization:"Bearer "+i.getToken()},beforeSend:function(e){if(this.loading&&(this.layerIndex=s.load(2,{shade:[.5,"#393D49"]})),"html"!==this.dataType){let e="/",t=n.removePrefix(this.url,e),o=n.removeSuffix("/",e);this.url=`${o}/${t}`}this.data&&"POST"===this.method.toUpperCase()&&(this.data=JSON.stringify(this.data))},success:function(e){t(e)},error:function(e,t,n){let i=e?.responseJSON?.msg;switch(console.error(e?.responseJSON),e.status){case 400:s.msg(i,{icon:0});break;case 401:i="未登录或会话已过期！",s.alert(i,{icon:0,closeBtn:0,title:"会话过期提醒！"},(function(e){s.close(e),sessionStorage.clear(),h.loadLogin()}));break;case 403:s.open({icon:4,title:"无权限！",content:i,closeBtn:0,yes:function(e,t,n){s.close(e)}});break;case 404:s.msg(i,{icon:2,title:"找不到资源！"});break;case 408:s.msg("请求超时！",{icon:2});break;default:s.msg("服务器发生异常，请联系管理员！",{icon:2})}o(n)},complete:function(e,t){s.close(this.layerIndex),this.url.endsWith("/login")||"GET"!==this.method.toUpperCase()&&200==e.status&&s.msg("操作成功！",{icon:1,time:800})}})}))}},l=layui.jquery,c=layui.layer,u=layui.laytpl,d=e("t",{getTemplate:function(e){let t;return e.endsWith(".html")?r.get({loading:!1,url:e,dataType:"html"}):(t=n.isValidCssSelector(e)?l(e).html():e,Promise.resolve(t))},getData:function(e={}){return n.isString(e)?r.get({loading:!1,url:e}):Promise.resolve(e)},load:function(e,t,n={}){let o=c.load(2,{shade:[1,"#FFF"]}),i=this.getTemplate(t),a=this.getData(n);Promise.all([i,a]).then((([t,n])=>{u(t).render(n,(t=>{l(e).empty().html(t),this.reloadScripts(e),c.close(o)}))}))},reloadScripts:function(e){let t=document.querySelector(e),n=t.getElementsByTagName("script");Array.from(n).forEach((e=>{let n=document.createElement("script");n.type=e.type?e.type:"text/javascript",e.src?n.src=e.src+"?t="+Date.now():n.textContent=e.innerHTML,e.remove(),t.appendChild(n)}))}});e("c",(()=>r.get({url:"/captcha"}))),e("b",(()=>r.get({url:"/captchaEnabled"})));let h=e("a",{isLogin:function(){return!n.isEmpty(i.get())},login:function(e){(e=>r.post({url:"/login",data:e}))(e).then((e=>{i.set(e.data),this.loadAdmin()}))},logout:function(){r.post({url:"/logout"}).then((e=>{sessionStorage.clear(),this.loadLogin()}))},loadAdmin:function(){d.load("#app","src/views/admin.html")},loadLogin:function(){d.load("#app","src/views/login.html")},loadHeader:function(){d.load(".layui-header","src/views/layout/lay-header.html")},loadSide:function(){d.load(".layui-side","src/views/layout/lay-side.html")},loadBody:function(){d.load(".layui-body","src/views/layout/lay-body.html")},loadFooter:function(){d.load(".layui-footer","src/views/layout/lay-footer.html")}})}}}));
