System.register([],(function(e,t){"use strict";return{execute:function(){let t=e("u",{isString:function(e){return"string"==typeof e||e instanceof String},isBlank:function(e){if(!e){let t=e.toString().replace(/\s/g,"").trim();return""==t||"undefined"==t||"null"==t}return!0},isEmpty:function(e){return!e||(this.isString(e)?this.isBlank(e):0===Object.getOwnPropertyNames(e).length)},isValidCssSelector:function(e){try{return document.querySelector(e),!0}catch(t){return!1}},blankToDefault:function(e,t){return this.isBlank(e)?t:e},removePrefix:function(e,t){return e.startsWith(t)?e.slice(t.length):e},removeSuffix:function(e,t){return e.endsWith(t)?e.slice(0,-t.length):e},getCssVar:function(e){let t=document.documentElement;return getComputedStyle(t).getPropertyValue(e)}});const n="vita-storage";let o=e("d",{name:"user",get:function(){return layui.sessionData(n)[this.name]},set:function(e){layui.sessionData(n,{key:this.name,value:e})},del:function(){layui.sessionData(n,{key:this.name,remove:!0})},getToken:function(){return this.get()?.token}}),a=layui.$,i=layui.layer,s={get:function(e){return e.method="GET",e.processData=!0,this.request(e)},post:function(e){return e.method="POST",e.processData=!1,this.request(e)},request:function(e){return new Promise((function(n,s){a.ajax({loading:e.loading??!0,layerIndex:e.layerIndex??-1,method:e.method??"POST",url:e.url,data:e.data,async:e.async??!0,cache:e.cache??!0,contentType:e.contentType??"application/json;charset=UTF-8",processData:e.processData??!1,dataType:e.dataType??"json",headers:e.header??{Authorization:"Bearer "+o.getToken()},beforeSend:function(e){if(this.loading&&(this.layerIndex=i.load(2,{shade:[.5,"#393D49"]})),"html"!==this.dataType){let e="/",n=t.removePrefix(this.url,e),o=t.removeSuffix("/",e);this.url=`${o}/${n}`}this.data&&"POST"===this.method.toUpperCase()&&(this.data=JSON.stringify(this.data))},success:function(e){n(e)},error:function(e,t,n){let o=e?.responseJSON?.msg;switch(console.error(e?.responseJSON),e.status){case 400:i.msg(o,{icon:0});break;case 401:o="未登录或会话已过期！",i.alert(o,{icon:0,closeBtn:0,title:"会话过期提醒！"},(function(e){i.close(e),sessionStorage.clear(),d.loadLogin()}));break;case 403:i.open({icon:4,title:"无权限！",content:o,closeBtn:0,yes:function(e,t,n){i.close(e)}});break;case 404:i.msg(o,{icon:2,title:"找不到资源！"});break;case 408:i.msg("请求超时！",{icon:2});break;default:i.msg("服务器发生异常，请联系管理员！",{icon:2})}s(n)},complete:function(e,t){i.close(this.layerIndex),this.url.endsWith("/login")||"GET"!==this.method.toUpperCase()&&200==e.status&&i.msg("操作成功！",{icon:1,time:800})}})}))}},r=layui.jquery,l=layui.layer,c=layui.laytpl,u=e("t",{getTemplate:function(e){let n;return e.endsWith(".html")?s.get({loading:!1,url:e,dataType:"html"}):(n=t.isValidCssSelector(e)?r(e).html():e,Promise.resolve(n))},getData:function(e={}){return t.isString(e)?s.get({loading:!1,url:e}):Promise.resolve(e)},load:function(e,t,n={}){let o=l.load(2,{shade:[1,"#FFF"]}),a=this.getTemplate(t),i=this.getData(n);Promise.all([a,i]).then((([t,n])=>{c(t).render(n,(t=>{r(e).empty().html(t),this.reloadScripts(e),l.close(o)}))}))},reloadScripts:function(e){let t=document.querySelector(e),n=t.getElementsByTagName("script");Array.from(n).forEach((e=>{let n=document.createElement("script");n.type=e.type?e.type:"text/javascript",e.src?n.src=e.src+"?t="+Date.now():n.textContent=e.innerHTML,e.remove(),t.appendChild(n)}))}});e("c",(()=>s.get({url:"/captcha"}))),e("b",(()=>s.get({url:"/captchaEnabled"})));let d=e("a",{isLogin:function(){return!t.isEmpty(o.get())},login:function(e){(e=>s.post({url:"/login",data:e}))(e).then((e=>{o.set(e.data),this.loadAdmin()}))},logout:function(){s.post({url:"/logout"}).then((e=>{sessionStorage.clear(),this.loadLogin()}))},loadAdmin:function(){u.load("#app","src/views/admin.html")},loadLogin:function(){u.load("#app","src/views/login.html")},loadHeader:function(){u.load(".layui-header","src/views/layout/lay-header.html")},loadSide:function(){u.load(".layui-side","src/views/layout/lay-side.html")},loadBody:function(){u.load(".layui-body","src/views/layout/lay-body.html")},loadFooter:function(){u.load(".layui-footer","src/views/layout/lay-footer.html")}})}}}));
