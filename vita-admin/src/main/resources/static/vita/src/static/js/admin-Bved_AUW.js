let D=layui.$,c={isMobile:function(){return D(window).width()<=750},isString:function(e){return typeof e=="string"||e instanceof String},isBlank:function(e){if(!e){let t=e.toString().replace(/\s/g,"").trim();return t==""||t=="undefined"||t=="null"}return!0},isEmpty:function(e){return e?this.isString(e)?this.isBlank(e):Object.getOwnPropertyNames(e).length===0:!0},isValidCssSelector:function(e){try{return document.querySelector(e),!0}catch(t){return!1}},blankToDefault:function(e,t){return this.isBlank(e)?t:e},removePrefix:function(e,t){return e.startsWith(t)?e.slice(t.length):e},removeSuffix:function(e,t){return e.endsWith(t)?e.slice(0,-t.length):e},getCssVar:function(e){let t=document.documentElement;return getComputedStyle(t).getPropertyValue(e)}};const S="vita-storage";let T={name:"user",get:function(){return layui.sessionData(S)[this.name]},set:function(e){layui.sessionData(S,{key:this.name,value:e})},del:function(){layui.sessionData(S,{key:this.name,remove:!0})},getToken:function(){var e;return(e=this.get())==null?void 0:e.token}};const B="/";let $=layui.$,i=layui.layer,o={get:function(e){return e.method="GET",e.processData=!0,this.request(e)},post:function(e){return e.method="POST",e.processData=!1,this.request(e)},request:function(e){return new Promise(function(t,u){var a,r,d,f,m,h,v,k,w;$.ajax({loading:(a=e.loading)!=null?a:!0,layerIndex:(r=e.layerIndex)!=null?r:-1,method:(d=e.method)!=null?d:"POST",url:e.url,data:e.data,async:(f=e.async)!=null?f:!0,cache:(m=e.cache)!=null?m:!0,contentType:(h=e.contentType)!=null?h:"application/json;charset=UTF-8",processData:(v=e.processData)!=null?v:!1,dataType:(k=e.dataType)!=null?k:"json",headers:(w=e.header)!=null?w:{Authorization:"Bearer "+T.getToken()},beforeSend:function(n){if(this.loading&&(this.layerIndex=i.load(2,{shade:[.5,"#393D49"]})),this.dataType!=="html"){let y="/",g=c.removePrefix(this.url,y),s=c.removeSuffix(B,y);this.url="".concat(s,"/").concat(g)}this.data&&this.method.toUpperCase()==="POST"&&(this.data=JSON.stringify(this.data))},success:function(n){t(n)},error:function(n,y,g){var E;let s=(E=n==null?void 0:n.responseJSON)==null?void 0:E.msg;switch(console.error(n==null?void 0:n.responseJSON),n.status){case 400:i.msg(s,{icon:0});break;case 401:s="未登录或会话已过期！",i.alert(s,{icon:0,closeBtn:0,title:"会话过期提醒！"},function(p){i.close(p),sessionStorage.clear(),q.loadLogin()});break;case 403:i.open({icon:4,title:"无权限！",content:s,closeBtn:0,yes:function(p,N,F){i.close(p)}});break;case 404:i.msg(s,{icon:2,title:"找不到资源！"});break;case 408:i.msg("请求超时！",{icon:2});break;default:i.msg("服务器发生异常，请联系管理员！",{icon:2});break}u(g)},complete:function(n,y){i.close(this.layerIndex),!this.url.endsWith("/login")&&this.method.toUpperCase()!=="GET"&&n.status==200&&i.msg("操作成功！",{icon:1,time:800})}})})}},P=layui.jquery,A=layui.layer,O=layui.laytpl,l={getTemplate:function(e){let t;return e.endsWith(".html")?o.get({loading:!1,url:e,dataType:"html"}):(c.isValidCssSelector(e)?t=P(e).html():t=e,Promise.resolve(t))},getData:function(e={}){return c.isString(e)?o.get({loading:!1,url:e}):Promise.resolve(e)},load:function(e,t,u={}){let a=A.load(2,{shade:[1,"#FFF"]}),r=this.getTemplate(t),d=this.getData(u);Promise.all([r,d]).then(([f,m])=>{O(f).render(m,h=>{P(e).empty().html(h),this.reloadScripts(e),A.close(a)})})},reloadScripts:function(e){let t=document.querySelector(e),u=t.getElementsByTagName("script");Array.from(u).forEach(a=>{let r=document.createElement("script");r.type=a.type?a.type:"text/javascript",a.src?r.src=a.src+"?t="+Date.now():r.textContent=a.innerHTML,a.remove(),t.appendChild(r)})}};const b=e=>o.post({url:"/login",data:e}),C=()=>o.post({url:"/logout"}),I=()=>o.get({url:"/captcha"}),L=()=>o.get({url:"/captchaEnabled"});let q={isLogin:function(){return!c.isEmpty(T.get())},login:function(e){b(e).then(t=>{T.set(t.data),this.loadAdmin()})},logout:function(){C().then(e=>{sessionStorage.clear(),this.loadLogin()})},loadAdmin:function(){l.load("#app","src/views/admin.html")},loadLogin:function(){l.load("#app","src/views/login.html")},loadHeader:function(){l.load(".layui-header","src/views/layout/lay-header.html")},loadSide:function(){l.load(".layui-side","src/views/layout/lay-side.html")},loadBody:function(){l.load(".layui-body","src/views/layout/lay-body.html")},loadFooter:function(){l.load(".layui-footer","src/views/layout/lay-footer.html")}};export{q as a,L as b,I as c,T as d,l as t,c as u};
