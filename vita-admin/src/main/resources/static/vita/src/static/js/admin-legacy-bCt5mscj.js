System.register([],(function(t,e){"use strict";return{execute:function(){let e=layui.$,n=t("b",{isMobile:function(){return e(window).width()<=750},isString:function(t){return"string"==typeof t||t instanceof String},isBlank:function(t){if(!t){let e=t.toString().replace(/\s/g,"").trim();return""==e||"undefined"==e||"null"==e}return!0},isEmpty:function(t){return!t||(this.isString(t)?this.isBlank(t):0===Object.getOwnPropertyNames(t).length)},isValidCssSelector:function(t){try{return document.querySelector(t),!0}catch(e){return!1}},blankToDefault:function(t,e){return this.isBlank(t)?e:t},removePrefix:function(t,e){return t.startsWith(e)?t.slice(e.length):t},removeSuffix:function(t,e){return t.endsWith(e)?t.slice(0,-e.length):t},getCssVar:function(t){let e=document.documentElement;return getComputedStyle(e).getPropertyValue(t)}});const o="vita-storage";let i=t("c",{name:"user",get:function(){return layui.sessionData(o)[this.name]},set:function(t){layui.sessionData(o,{key:this.name,value:t})},del:function(){layui.sessionData(o,{key:this.name,remove:!0})},getToken:function(){return this.get()?.token}}),a=layui.$,s=layui.layer,r={get:function(t){return t.method="GET",t.processData=!0,this.request(t)},post:function(t){return t.method="POST",t.processData=!1,this.request(t)},request:function(t){return new Promise((function(e,o){a.ajax({loading:t.loading??!0,layerIndex:t.layerIndex??-1,method:t.method??"POST",url:t.url,data:t.data,async:t.async??!0,cache:t.cache??!0,contentType:t.contentType??"application/json;charset=UTF-8",processData:t.processData??!1,dataType:t.dataType??"json",headers:t.header??{Authorization:"Bearer "+i.getToken()},beforeSend:function(t){if(this.loading&&(this.layerIndex=s.load(2,{shade:[.5,"#393D49"]})),"html"!==this.dataType){let t="/",e=n.removePrefix(this.url,t),o=n.removeSuffix("/",t);this.url=`${o}/${e}`}this.data&&"POST"===this.method.toUpperCase()&&(this.data=JSON.stringify(this.data))},success:function(t){e(t)},error:function(t,e,n){let i=t?.responseJSON?.msg;switch(console.error(t?.responseJSON),t.status){case 400:s.msg(i,{icon:0});break;case 401:i="未登录或会话已过期！",s.alert(i,{icon:0,closeBtn:0,title:"会话过期提醒！"},(function(t){s.close(t),sessionStorage.clear(),m.loadLogin()}));break;case 403:s.open({icon:4,title:"无权限！",content:i,closeBtn:0,yes:function(t,e,n){s.close(t)}});break;case 404:s.msg(i,{icon:2,title:"找不到资源！"});break;case 408:s.msg("请求超时！",{icon:2});break;default:s.msg("服务器发生异常，请联系管理员！",{icon:2})}o(n)},complete:function(t,e){s.close(this.layerIndex),this.url.endsWith("/login")||"GET"!==this.method.toUpperCase()&&200==t.status&&s.msg("操作成功！",{icon:1,time:800})}})}))}},l=layui.jquery,c=layui.layer,u=layui.laytpl,d=t("t",{getTemplate:function(t){let e;return t.endsWith(".html")?r.get({loading:!1,url:t,dataType:"html"}):(e=n.isValidCssSelector(t)?l(t).html():t,Promise.resolve(e))},getData:function(t={}){return n.isString(t)?r.get({loading:!1,url:t}):Promise.resolve(t)},load:function(t,e,n={}){let o=c.load(2,{shade:[1,"#FFF"]}),i=this.getTemplate(e),a=this.getData(n);Promise.all([i,a]).then((([e,n])=>{u(e).render(n,(e=>{l(t).empty().html(e),this.reloadScripts(t),c.close(o)}))}))},reloadScripts:function(t){let e=document.querySelector(t),n=e.getElementsByTagName("script");Array.from(n).forEach((t=>{let n=document.createElement("script");n.type=t.type?t.type:"text/javascript",t.src?n.src=t.src+"?t="+Date.now():n.textContent=t.innerHTML,t.remove(),e.appendChild(n)}))}}),h=t("u",{login:t=>r.post({url:"/login",data:t}),logout:()=>r.post({url:"/logout"}),captcha:()=>r.get({url:"/captcha"}),captchaEnabled:()=>r.get({url:"/captchaEnabled"})}),m=t("a",{isLogin:function(){return!n.isEmpty(i.get())},login:function(t){h.login(t).then((t=>{i.set(t.data),this.loadAdmin()}))},logout:function(){h.logout().then((t=>{sessionStorage.clear(),this.loadLogin()}))},loadAdmin:function(){d.load("#app","src/views/admin.html")},loadLogin:function(){d.load("#app","src/views/login.html")},loadHeader:function(){d.load(".layui-header","src/views/layout/lay-header.html")},loadSide:function(){d.load(".layui-side","src/views/layout/lay-side.html")},loadBody:function(){d.load(".layui-body","src/views/layout/lay-body.html")},loadFooter:function(){d.load(".layui-footer","src/views/layout/lay-footer.html")}})}}}));
