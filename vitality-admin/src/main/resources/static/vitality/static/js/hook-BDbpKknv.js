var I=(d,f,l)=>new Promise((s,m)=>{var o=t=>{try{i(l.next(t))}catch(r){m(r)}},p=t=>{try{i(l.throw(t))}catch(r){m(r)}},i=t=>t.done?s(t.value):Promise.resolve(t.value).then(o,p);i((l=l.apply(d,f)).next())});import{e as N,r as h,o as O,I as _,ba as R,Y as M,gC as j,bt as q,a7 as F,aa as S,aj as x}from"./index-DcU5f0E9.js";import{_ as z}from"./form.vue_vue_type_script_setup_true_lang-Bd4ukqMZ.js";import{g as B,u as V,c as $,d as A}from"./dept-DUzhRyco.js";import{R as G}from"./index-o8UmT3vP.js";import"./index-C4DFYXhp.js";import"./dict-Bc4Ygahn.js";function E(){const d=N({}),f=h(),l=h([]),s=h(!0),m=[{label:"部门名称",prop:"name",minWidth:260,align:"left"},{label:"状态",prop:"disabled",minWidth:70,cellRenderer:({row:a,props:e})=>_(G,{size:e.size,code:"vtl_disabled",value:a.disabled},null)},{label:"排序",prop:"seq",minWidth:70,hide:!1},{label:"备注",prop:"remark",minWidth:160,hide:!0},{label:"ID",prop:"id",minWidth:180,align:"left",hide:!0},{label:"创建者",minWidth:100,prop:"createByName"},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:a})=>R(a).format("YYYY-MM-DD HH:mm:ss")},{label:"更新者",minWidth:100,prop:"updateByName"},{label:"更新时间",minWidth:160,prop:"updateTime",formatter:({updateTime:a})=>R(a).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:210,slot:"operation"}];function o(a){}function p(a){a&&(a.resetFields(),i())}function i(){return I(this,null,function*(){s.value=!0;let a=yield B();M(d.name)||(a=a.filter(e=>e.name.includes(d.name))),M(d.disabled)||(a=a.filter(e=>e.disabled===d.disabled)),l.value=j(a),setTimeout(()=>{s.value=!1},500)})}function t(a){if(!a||!a.length)return;const e=[];for(let n=0;n<a.length;n++)a[n].disabled=a[n].disabled==="Y",t(a[n].children),e.push(a[n]);return e}function r(a="新增",e){var n,b,g,D,v,Y;q({title:`${a}部门`,props:{formInline:{id:(n=e==null?void 0:e.id)!=null?n:null,parentId:(b=e==null?void 0:e.parentId)!=null?b:"0",name:(g=e==null?void 0:e.name)!=null?g:"",seq:(D=e==null?void 0:e.seq)!=null?D:0,disabled:(v=e==null?void 0:e.disabled)!=null?v:"N",remark:(Y=e==null?void 0:e.remark)!=null?Y:""},higherDeptOptions:t(F(l.value))},width:"40%",draggable:!0,fullscreen:S(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(z,{ref:f,formInline:null,higherDeptOptions:null}),beforeSure:(H,{options:k})=>{const y=f.value.getRef(),c=k.props.formInline;function W(){H(),i()}y.validate(C=>{C&&(c.id?V(c).then(u=>{u.code===200&&W()}):$(c).then(u=>{u.code===200&&W()}))})}})}function T(a){A(a.id).then(e=>{e.code===200&&i()})}return O(()=>{i()}),{form:d,loading:s,columns:m,dataList:l,onSearch:i,resetForm:p,openDialog:r,handleDelete:T,handleSelectionChange:o}}export{E as useDept};
