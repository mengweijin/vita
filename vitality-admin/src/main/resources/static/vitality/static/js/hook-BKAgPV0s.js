var I=(d,f,l)=>new Promise((s,m)=>{var p=t=>{try{i(l.next(t))}catch(r){m(r)}},o=t=>{try{i(l.throw(t))}catch(r){m(r)}},i=t=>t.done?s(t.value):Promise.resolve(t.value).then(p,o);i((l=l.apply(d,f)).next())});import{r as O,a as h,m as _,i as q,aX as R,aZ as M,gn as C,af as F,ad as S,X as j,L as x}from"./index-BOgzzpjy.js";import{_ as z}from"./form.vue_vue_type_script_setup_true_lang-D60PCWrd.js";import{g as B,u as X,c as V,d as Z}from"./dept-CpRwwCE2.js";import{R as $}from"./index-BRe61WGV.js";import"./index-0xZT4ftg.js";import"./dict-BGJzepeb.js";function E(){const d=O({}),f=h(),l=h([]),s=h(!0),m=[{label:"部门名称",prop:"name",minWidth:260,align:"left"},{label:"状态",prop:"disabled",minWidth:70,cellRenderer:({row:a,props:e})=>q($,{size:e.size,code:"vtl_disabled",value:a.disabled},null)},{label:"排序",prop:"seq",minWidth:70,hide:!1},{label:"备注",prop:"remark",minWidth:160,hide:!0},{label:"ID",prop:"id",minWidth:180,align:"left",hide:!0},{label:"创建者",minWidth:100,prop:"createByName"},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:a})=>R(a).format("YYYY-MM-DD HH:mm:ss")},{label:"更新者",minWidth:100,prop:"updateByName"},{label:"更新时间",minWidth:160,prop:"updateTime",formatter:({updateTime:a})=>R(a).format("YYYY-MM-DD HH:mm:ss")},{label:"操作",fixed:"right",width:210,slot:"operation"}];function p(a){}function o(a){a&&(a.resetFields(),i())}function i(){return I(this,null,function*(){s.value=!0;let a=yield B();M(d.name)||(a=a.filter(e=>e.name.includes(d.name))),M(d.disabled)||(a=a.filter(e=>e.disabled===d.disabled)),l.value=C(a),setTimeout(()=>{s.value=!1},500)})}function t(a){if(!a||!a.length)return;const e=[];for(let n=0;n<a.length;n++)a[n].disabled=a[n].disabled==="Y",t(a[n].children),e.push(a[n]);return e}function r(a="新增",e){var n,b,g,D,v,W;F({title:`${a}部门`,props:{formInline:{id:(n=e==null?void 0:e.id)!=null?n:null,parentId:(b=e==null?void 0:e.parentId)!=null?b:"0",name:(g=e==null?void 0:e.name)!=null?g:"",seq:(D=e==null?void 0:e.seq)!=null?D:0,disabled:(v=e==null?void 0:e.disabled)!=null?v:"N",remark:(W=e==null?void 0:e.remark)!=null?W:""},higherDeptOptions:t(S(l.value))},width:"40%",draggable:!0,fullscreen:j(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>x(z,{ref:f,formInline:null,higherDeptOptions:null}),beforeSure:(H,{options:k})=>{const y=f.value.getRef(),c=k.props.formInline;function Y(){H(),i()}y.validate(N=>{N&&(c.id?X(c).then(u=>{u.code===200&&Y()}):V(c).then(u=>{u.code===200&&Y()}))})}})}function T(a){Z(a.id).then(e=>{e.code===200&&i()})}return _(()=>{i()}),{form:d,loading:s,columns:m,dataList:l,onSearch:i,resetForm:o,openDialog:r,handleDelete:T,handleSelectionChange:p}}export{E as useDept};
