var v=(i,u,n)=>new Promise((g,c)=>{var f=l=>{try{r(n.next(l))}catch(m){c(m)}},p=l=>{try{r(n.throw(l))}catch(m){c(m)}},r=l=>l.done?g(l.value):Promise.resolve(l.value).then(f,p);r((n=n.apply(i,u)).next())});import{r as I,a as t,m as J,gn as Z,ao as w,n as W,aa as x,i as ee,e as ae,aX as R,fv as te,bo as le,af as ne,X as ie,L as se}from"./index-BOgzzpjy.js";import{_ as oe}from"./form.vue_vue_type_script_setup_true_lang-CUagFHb4.js";import{u as L,d as re,g as de,c as ue,s as ce}from"./role-sMsAc2kK.js";import{g as fe,a as me}from"./menu-m-RuHVSn.js";function ye(i){const u=I({}),n=t(),g=t(),c=t([]),f=t([]),p=t([]),r=t(!1),l=t(!0),m=t(!1),P=t(),h=t({}),S=t(!1),C=t(!1),T={value:"id",label:"title",children:"children"},o=I({total:0,pageSize:10,currentPage:1,background:!0,pageSizes:[10,20,30,50]}),B=[{label:"角色编号",prop:"id",minWidth:180,align:"left",hide:!0},{label:"角色名称",prop:"name",minWidth:180},{label:"角色标识",prop:"code",minWidth:180},{label:"状态",prop:"disabled",minWidth:90,cellRenderer:e=>{var a;return ee(ae("el-switch"),{size:e.props.size==="small"?"small":"default",loading:(a=h.value[e.index])==null?void 0:a.loading,modelValue:e.row.disabled,"onUpdate:modelValue":s=>e.row.disabled=s,"active-value":"N","inactive-value":"Y","active-text":"已启用","inactive-text":"已停用","inline-prompt":!0,style:"--el-switch-on-color: #6abe39; --el-switch-off-color: #e84749","before-change":()=>F(e)},null)}},{label:"排序",prop:"seq",minWidth:70,hide:!1},{label:"备注",prop:"remark",minWidth:160,hide:!0},{label:"创建者",minWidth:100,prop:"createByName",hide:!1},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:e})=>R(e).format("YYYY-MM-DD HH:mm:ss"),hide:!1},{label:"更新者",minWidth:100,prop:"updateByName",hide:!1},{label:"更新时间",minWidth:160,prop:"updateTime",formatter:({updateTime:e})=>R(e).format("YYYY-MM-DD HH:mm:ss"),hide:!1},{label:"操作",fixed:"right",width:210,slot:"operation"}];function F({row:e,index:a}){return te.confirm(`确认要<strong>【${e.disabled==="Y"?"启用":"停用"}】</strong><strong style='color:var(--el-color-primary)'>${e.name} </strong>吗?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0,draggable:!0}).then(()=>{h.value[a]=Object.assign({},h.value[a],{loading:!0})}).then(()=>{let s=e.disabled==="Y"?"N":"Y";L({id:e.id,disabled:s}).then(()=>{e.disabled=s})}).finally(()=>{h.value[a]=Object.assign({},h.value[a],{loading:!1})}),!1}function K(e){re(e.id).then(a=>{a.code===200&&d()})}function H(e){o.pageSize=e,d()}function N(e){o.currentPage=e,d()}function V(e){}function d(){return v(this,null,function*(){l.value=!0,u.current=o.currentPage,u.size=o.pageSize;const e=yield de(le(u));c.value=e.records,o.pageSize=e.size,o.currentPage=e.current,o.total=e.total,setTimeout(()=>{l.value=!1},500)})}const j=e=>{e&&(e.resetFields(),d())};function q(e="新增",a){var s,M,D,Y,k;ne({title:`${e}角色`,props:{formInline:{id:(s=a==null?void 0:a.id)!=null?s:null,name:(M=a==null?void 0:a.name)!=null?M:"",code:(D=a==null?void 0:a.code)!=null?D:"",seq:(Y=a==null?void 0:a.seq)!=null?Y:0,remark:(k=a==null?void 0:a.remark)!=null?k:""}},width:"40%",draggable:!0,fullscreen:ie(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>se(oe,{ref:g,formInline:null}),beforeSure:(U,{options:X})=>{const Q=g.value.getRef(),b=X.props.formInline;function z(){U(),d()}Q.validate(G=>{G&&(b.id?L(b).then(y=>{y.code===200&&z()}):ue(b).then(y=>{y.code===200&&z()}))})}})}function E(e){return v(this,null,function*(){const{id:a}=e;if(a){n.value=e,r.value=!0;const s=yield me(a);i.value.setCheckedKeys(s)}else n.value=null,r.value=!1})}function O({row:{id:e}}){var a;return{cursor:"pointer",background:e===((a=n.value)==null?void 0:a.id)?"var(--el-fill-color-light)":""}}function _(){const{id:e}=n.value;ce({roleId:e,menuIds:i.value.getCheckedKeys()})}const $=e=>{i.value.filter(e)},A=(e,a)=>x(a.title).includes(e);return J(()=>v(this,null,function*(){d();let e=yield fe();p.value=Z(e),f.value=w(e,"id")})),W(S,e=>{e?i.value.setExpandedKeys(f.value):i.value.setExpandedKeys([])}),W(C,e=>{e?i.value.setCheckedKeys(f.value):i.value.setCheckedKeys([])}),{form:u,isShow:r,curRow:n,loading:l,columns:B,rowStyle:O,dataList:c,treeData:p,treeProps:T,isLinkage:m,pagination:o,isExpandAll:S,isSelectAll:C,treeSearchValue:P,onSearch:d,resetForm:j,openDialog:q,handleMenu:E,handleSave:_,handleDelete:K,filterMethod:A,transformI18n:x,onQueryChanged:$,handleSizeChange:H,handleCurrentChange:N,handleSelectionChange:V}}export{ye as useRole};
