var S=(U,k,i)=>new Promise((V,g)=>{var f=u=>{try{l(i.next(u))}catch(b){g(b)}},w=u=>{try{l(i.throw(u))}catch(b){g(b)}},l=u=>u.done?V(u.value):Promise.resolve(u.value).then(f,w);l((i=i.apply(U,k)).next())});import{u as M}from"./user-D6ptNJJ0.js";import{a as h,s as j,u as X}from"./user-rLFhlVSh.js";import{R as $}from"./index-UGXc8PlG.js";import{d as G,a as v,r as A,e as r,f as C,k as F,g as R,i as a,w as n,u as _,F as J,l as K,b as Q,h as I,X as L,v as W,g0 as Y}from"./index-BOgzzpjy.js";import{d as Z}from"./upload-line-ClmDKJCy.js";import{u as ee}from"./dict-BGJzepeb.js";const le={class:"dialog-footer"},ie=G({name:"Profile",__name:"Profile",setup(U){const k=v(""),i=v(),V=v(),g=v(),f=v(!1),w=v(),l=A({}),u=A({nickname:[{required:!0,message:"昵称必填",trigger:"blur"}]});function b(o,e){const p=[{value:"@qq.com"},{value:"@foxmail.com"},{value:"@gmail.com"},{value:"@aliyun.com"},{value:"@126.com"},{value:"@163.com"}];let m=[],s=[];p.map(d=>s.push({value:o.split("@")[0]+d.value})),m=o?s.filter(d=>d.value.toLowerCase().indexOf(o.toLowerCase())===0):s,e(m)}const O=o=>{const e=new FileReader;e.onload=p=>{k.value=p.target.result,f.value=!0},e.readAsDataURL(o.raw)},y=()=>{V.value.hidePopover(),g.value.clearFiles(),f.value=!1},B=o=>i.value=o,P=()=>{const o={userId:l.id,avatar:i.value.base64};j(o).then(e=>{e.code==200&&(l.avatar=o.avatar,Y().SET_AVATAR(o.avatar),y())})},q=o=>S(this,null,function*(){yield o.validate((e,p)=>{var m,s;if(e){const d={id:l.id,nickname:l.nickname,gender:(m=l.gender)!=null?m:"",remark:(s=l.remark)!=null?s:""};X(d)}})});return h().then(o=>{Object.assign(l,o)}),(o,e)=>{const p=r("el-avatar"),m=r("IconifyIconOffline"),s=r("el-button"),d=r("el-upload"),c=r("el-form-item"),x=r("el-input"),z=r("el-option"),D=r("el-select"),E=r("el-autocomplete"),N=r("el-form"),T=r("el-dialog");return C(),F("div",{class:W(["min-w-[180px]",_(L)()?"max-w-[100%]":"max-w-[70%]"])},[e[11]||(e[11]=R("h3",{class:"my-8"},"个人信息",-1)),a(N,{ref_key:"userInfoFormRef",ref:w,"label-position":"top",rules:u,model:l},{default:n(()=>[a(c,{label:"头像"},{default:n(()=>[a(p,{size:80,src:l.avatar||_(M)},null,8,["src"]),a(d,{ref_key:"uploadRef",ref:g,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":O},{default:n(()=>[a(s,{plain:"",class:"ml-4"},{default:n(()=>[a(m,{icon:_(Z)},null,8,["icon"]),e[7]||(e[7]=R("span",{class:"ml-2"},"更新头像",-1))]),_:1})]),_:1},512)]),_:1}),a(c,{label:"昵称",prop:"nickname"},{default:n(()=>[a(x,{modelValue:l.nickname,"onUpdate:modelValue":e[0]||(e[0]=t=>l.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(c,{label:"性别",prop:"gender"},{default:n(()=>[a(D,{modelValue:l.gender,"onUpdate:modelValue":e[1]||(e[1]=t=>l.gender=t),placeholder:"请选择性别",clearable:"",class:"!w-[180px]",style:{width:"100% !important"}},{default:n(()=>[(C(!0),F(J,null,K(_(ee)().getDicts("vtl_user_gender"),(t,H)=>(C(),Q(z,{key:H,label:t.label,value:t.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"绑定邮箱",prop:"email"},{default:n(()=>[a(E,{modelValue:l.email,"onUpdate:modelValue":e[2]||(e[2]=t=>l.email=t),"fetch-suggestions":b,"trigger-on-focus":!1,placeholder:"请输入邮箱",clearable:"",disabled:"",class:"w-full"},null,8,["modelValue"])]),_:1}),a(c,{label:"绑定手机"},{default:n(()=>[a(x,{modelValue:l.mobile,"onUpdate:modelValue":e[3]||(e[3]=t=>l.mobile=t),placeholder:"请输入手机号码",clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"简介"},{default:n(()=>[a(x,{modelValue:l.remark,"onUpdate:modelValue":e[4]||(e[4]=t=>l.remark=t),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"56","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(s,{type:"primary",onClick:e[5]||(e[5]=t=>q(w.value))},{default:n(()=>e[8]||(e[8]=[I(" 更新信息 ")])),_:1})]),_:1},8,["rules","model"]),a(T,{modelValue:f.value,"onUpdate:modelValue":e[6]||(e[6]=t=>f.value=t),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":y,fullscreen:_(L)()},{footer:n(()=>[R("div",le,[a(s,{bg:"",text:"",onClick:y},{default:n(()=>e[9]||(e[9]=[I("取消")])),_:1}),a(s,{bg:"",text:"",type:"primary",onClick:P},{default:n(()=>e[10]||(e[10]=[I(" 确定 ")])),_:1})])]),default:n(()=>[a(_($),{ref_key:"cropRef",ref:V,imgSrc:k.value,onCropper:B},null,8,["imgSrc"])]),_:1},8,["modelValue","fullscreen"])],2)}}});export{ie as _};
