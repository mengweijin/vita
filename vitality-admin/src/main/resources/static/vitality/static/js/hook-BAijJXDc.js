var R=(a,o,s)=>new Promise((d,c)=>{var m=i=>{try{n(s.next(i))}catch(r){c(r)}},p=i=>{try{n(s.throw(i))}catch(r){c(r)}},n=i=>i.done?d(i.value):Promise.resolve(i.value).then(m,p);n((s=s.apply(a,o)).next())});import{bc as f,e as _,r as g,o as j,I as q,ba as M,Y as b,gC as F,bt as S,a7 as x,aa as z,aj as B}from"./index-DcU5f0E9.js";import{_ as V}from"./form.vue_vue_type_script_setup_true_lang-BR2mePQA.js";import{R as $}from"./index-o8UmT3vP.js";import"./index-C4DFYXhp.js";import"./dict-Bc4Ygahn.js";const A=a=>f.get("/system/category/list",{params:a}),G=a=>f.post("/system/category/create",{data:a}),J=a=>f.post("/system/category/update",{data:a}),K=a=>f.post("/system/category/delete/"+a);function L(){const a=_({}),o=g(),s=g([]),d=g(!0),c=[{label:"名称",prop:"name",minWidth:200,align:"left"},{label:"编码",prop:"code",minWidth:200,align:"left"},{label:"状态",prop:"disabled",minWidth:70,cellRenderer:({row:t,props:e})=>q($,{size:e.size,code:"vtl_disabled",value:t.disabled},null)},{label:"排序",prop:"seq",minWidth:70,hide:!1},{label:"备注",prop:"remark",minWidth:160,hide:!1},{label:"ID",prop:"id",minWidth:180,align:"left",hide:!0},{label:"创建者",minWidth:100,prop:"createByName"},{label:"创建时间",minWidth:160,prop:"createTime",formatter:({createTime:t})=>M(t).format("YYYY-MM-DD HH:mm:ss")},{label:"更新者",minWidth:100,prop:"updateByName",hide:!0},{label:"更新时间",minWidth:160,prop:"updateTime",formatter:({updateTime:t})=>M(t).format("YYYY-MM-DD HH:mm:ss"),hide:!0},{label:"操作",fixed:"right",width:210,slot:"operation"}];function m(t){}function p(t){t&&(t.resetFields(),n())}function n(){return R(this,null,function*(){d.value=!0;let t=yield A();b(a.name)||(t=t.filter(e=>e.name.includes(a.name))),b(a.code)||(t=t.filter(e=>e.code.includes(a.code))),b(a.disabled)||(t=t.filter(e=>e.disabled===a.disabled)),s.value=F(t),setTimeout(()=>{d.value=!1},500)})}function i(t){if(!t||!t.length)return;const e=[];for(let l=0;l<t.length;l++)t[l].disabled=t[l].disabled==="Y",i(t[l].children),e.push(t[l]);return e}function r(t="新增",e){var l,y,D,v,W,Y,C;S({title:`${t}分类`,props:{formInline:{id:(l=e==null?void 0:e.id)!=null?l:null,parentId:(y=e==null?void 0:e.parentId)!=null?y:"0",name:(D=e==null?void 0:e.name)!=null?D:"",code:(v=e==null?void 0:e.code)!=null?v:"",seq:(W=e==null?void 0:e.seq)!=null?W:0,disabled:(Y=e==null?void 0:e.disabled)!=null?Y:"N",remark:(C=e==null?void 0:e.remark)!=null?C:""},higherDeptOptions:i(x(s.value))},width:"40%",draggable:!0,fullscreen:z(),fullscreenIcon:!0,closeOnClickModal:!1,contentRenderer:()=>B(V,{ref:o,formInline:null,higherDeptOptions:null}),beforeSure:(H,{options:k})=>{const N=o.value.getRef(),u=k.props.formInline;function I(){H(),n()}N.validate(O=>{O&&(u.id?J(u).then(h=>{h.code===200&&I()}):G(u).then(h=>{h.code===200&&I()}))})}})}function T(t){K(t.id).then(e=>{e.code===200&&n()})}return j(()=>{n()}),{form:a,loading:d,columns:c,dataList:s,onSearch:n,resetForm:p,openDialog:r,handleDelete:T,handleSelectionChange:m}}export{L as useCategory};
