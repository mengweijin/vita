var S=(U,k,m)=>new Promise((V,g)=>{var p=u=>{try{l(m.next(u))}catch(b){g(b)}},w=u=>{try{l(m.throw(u))}catch(b){g(b)}},l=u=>u.done?V(u.value):Promise.resolve(u.value).then(p,w);l((m=m.apply(U,k)).next())});import{u as M}from"./user-D6ptNJJ0.js";import{a as j,s as K,u as $}from"./user-Bevwic4T.js";import{R as h}from"./index-CwMX2RGj.js";import{w as G,r as v,e as A,E as r,p as C,q as L,H as R,I as a,S as n,k as _,K as J,L as Q,V as W,T as I,aa as O,O as X,ax as Y}from"./index-DcU5f0E9.js";import{d as Z}from"./upload-line-ClmDKJCy.js";import{u as ee}from"./dict-Bc4Ygahn.js";const le={class:"dialog-footer"},me=G({name:"Profile",__name:"Profile",setup(U){const k=v(""),m=v(),V=v(),g=v(),p=v(!1),w=v(),l=A({}),u=A({nickname:[{required:!0,message:"昵称必填",trigger:"blur"}]});function b(o,e){const f=[{value:"@qq.com"},{value:"@foxmail.com"},{value:"@gmail.com"},{value:"@aliyun.com"},{value:"@126.com"},{value:"@163.com"}];let i=[],s=[];f.map(d=>s.push({value:o.split("@")[0]+d.value})),i=o?s.filter(d=>d.value.toLowerCase().indexOf(o.toLowerCase())===0):s,e(i)}const B=o=>{const e=new FileReader;e.onload=f=>{k.value=f.target.result,p.value=!0},e.readAsDataURL(o.raw)},x=()=>{V.value.hidePopover(),g.value.clearFiles(),p.value=!1},F=o=>m.value=o,P=()=>{const o={userId:l.id,avatar:m.value.base64};K(o).then(e=>{e.code==200&&(l.avatar=o.avatar,Y().SET_AVATAR(o.avatar),x())})},q=o=>S(this,null,function*(){yield o.validate((e,f)=>{var i,s;if(e){const d={id:l.id,nickname:l.nickname,gender:(i=l.gender)!=null?i:"",remark:(s=l.remark)!=null?s:""};$(d)}})});return j().then(o=>{Object.assign(l,o)}),(o,e)=>{const f=r("el-avatar"),i=r("IconifyIconOffline"),s=r("el-button"),d=r("el-upload"),c=r("el-form-item"),y=r("el-input"),E=r("el-option"),T=r("el-select"),z=r("el-autocomplete"),D=r("el-form"),H=r("el-dialog");return C(),L("div",{class:X(["min-w-[180px]",_(O)()?"max-w-[100%]":"max-w-[70%]"])},[e[11]||(e[11]=R("h3",{class:"my-8"},"个人信息",-1)),a(D,{ref_key:"userInfoFormRef",ref:w,"label-position":"top",rules:u,model:l},{default:n(()=>[a(c,{label:"头像"},{default:n(()=>[a(f,{size:80,src:l.avatar||_(M)},null,8,["src"]),a(d,{ref_key:"uploadRef",ref:g,accept:"image/*",action:"#",limit:1,"auto-upload":!1,"show-file-list":!1,"on-change":B},{default:n(()=>[a(s,{plain:"",class:"ml-4"},{default:n(()=>[a(i,{icon:_(Z)},null,8,["icon"]),e[7]||(e[7]=R("span",{class:"ml-2"},"更新头像",-1))]),_:1})]),_:1},512)]),_:1}),a(c,{label:"昵称",prop:"nickname"},{default:n(()=>[a(y,{modelValue:l.nickname,"onUpdate:modelValue":e[0]||(e[0]=t=>l.nickname=t),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(c,{label:"性别",prop:"gender"},{default:n(()=>[a(T,{modelValue:l.gender,"onUpdate:modelValue":e[1]||(e[1]=t=>l.gender=t),placeholder:"请选择性别",clearable:"",class:"!w-[180px]",style:{width:"100% !important"}},{default:n(()=>[(C(!0),L(J,null,Q(_(ee)().getDicts("vtl_user_gender"),(t,N)=>(C(),W(E,{key:N,label:t.label,value:t.val},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(c,{label:"绑定邮箱",prop:"email"},{default:n(()=>[a(z,{modelValue:l.email,"onUpdate:modelValue":e[2]||(e[2]=t=>l.email=t),"fetch-suggestions":b,"trigger-on-focus":!1,placeholder:"请输入邮箱",clearable:"",disabled:"",class:"w-full"},null,8,["modelValue"])]),_:1}),a(c,{label:"绑定手机"},{default:n(()=>[a(y,{modelValue:l.mobile,"onUpdate:modelValue":e[3]||(e[3]=t=>l.mobile=t),placeholder:"请输入手机号码",clearable:"",disabled:""},null,8,["modelValue"])]),_:1}),a(c,{label:"简介"},{default:n(()=>[a(y,{modelValue:l.remark,"onUpdate:modelValue":e[4]||(e[4]=t=>l.remark=t),placeholder:"请输入简介",type:"textarea",autosize:{minRows:6,maxRows:8},maxlength:"56","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(s,{type:"primary",onClick:e[5]||(e[5]=t=>q(w.value))},{default:n(()=>e[8]||(e[8]=[I(" 更新信息 ")])),_:1})]),_:1},8,["rules","model"]),a(H,{modelValue:p.value,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value=t),width:"40%",title:"编辑头像","destroy-on-close":"",closeOnClickModal:!1,"before-close":x,fullscreen:_(O)()},{footer:n(()=>[R("div",le,[a(s,{bg:"",text:"",onClick:x},{default:n(()=>e[9]||(e[9]=[I("取消")])),_:1}),a(s,{bg:"",text:"",type:"primary",onClick:P},{default:n(()=>e[10]||(e[10]=[I(" 确定 ")])),_:1})])]),default:n(()=>[a(_(h),{ref_key:"cropRef",ref:V,imgSrc:k.value,onCropper:F},null,8,["imgSrc"])]),_:1},8,["modelValue","fullscreen"])],2)}}});export{me as _};
